# 双核融合系统 - 快速参考

## 🎯 核心概念

**双核融合** = 两个独立的信号引擎 + 智能融合算法

```
Polymarket本地引擎        Binance Oracle引擎
(市场内部数据)      ↔      (外部真实资金流)
        ↘                    ↙
          双核融合算法
               ↓
         最终交易信号
```

---

## 📊 核心A: Polymarket本地引擎

**数据源**: Polymarket BTC 15分钟市场（每3秒轮询）

**评分组件**:
| 组件 | 权重 | 满分 |
|------|------|------|
| 价格动量 (10周期) | 1.0 | ±10 |
| VWAP偏离 (±0.5%) | 1.0 | ±5 |
| RSI状态 (60/40) | 1.0 | ±5 |
| 趋势强度 (3周期) | 1.0 | ±5 |
| 波动率调整 | 0.5-1.0 | 影响置信度 |

**输出**: 本地分数 (-10到+10)

---

## 🔮 核心B: Binance Oracle引擎

**数据源**: 3个Binance WebSocket连接（实时）

### 双CVD窗口系统

**1分钟即时窗口** (CVD_SHORT):
- 时间: 60秒
- 评分: cvd_short / 50000.0
- 满分: ±5万USD = ±3分
- 权重: **30%**

**5分钟趋势窗口** (CVD_LONG):
- 时间: 300秒
- 评分: cvd_long / 150000.0
- 满分: ±15万USD = ±5分
- 权重: **70%**

**融合计算**:
```
CVD分数 = (5分钟分数 × 0.7) + (1分钟分数 × 0.3)
```

### 其他组件

| 组件 | 权重 | 满分 |
|------|------|------|
| 盘口不平衡 | 1.0 | ±3 |
| UT Bot + Hull | 趋势过滤 | LONG/SHORT/NEUTRAL |
| MACD Histogram | 异常检测 | - |
| Delta Z-Score | 异常检测 | - |

**输出**: Oracle分数 (-10到+10)

---

## 🔄 融合算法

### 场景1: 完美共振 (同向)

**条件**: `本地分 × Oracle分 > 0`

```python
oracle_boost = Oracle分 / 5.0
最终分数 = 本地分 + oracle_boost
```

**示例**:
```
本地分: +4.0
Oracle: +5.0
计算: 4.0 + (5.0 ÷ 5) = 5.0
结果: 分数提升，信心增强
```

---

### 场景2: 谨慎重合 (反向)

**条件**: `本地分 × Oracle分 < 0`

```python
oracle_boost = Oracle分 / 10.0  # 权重减半
最终分数 = 本地分 + oracle_boost
```

**示例**:
```
本地分: +4.0
Oracle: -5.0
计算: 4.0 + (-5.0 ÷ 10) = 3.5
结果: 分数降低，Oracle削弱本地信号
```

---

### 场景3: 核弹级VIP通道

**条件**: `Oracle分数 ≥ 12.0`

```python
# 完全跳过融合逻辑，直接返回高分信号
return {
    'score': Oracle分,
    'strategy': 'WHALE_SNIPER',
    'defense_multiplier': 1.0  # 全仓通过
}
```

**示例**:
```
Oracle: +12.5
价格: $0.15 (深度超卖)
RSI: 22 (极度超卖)
结果: VIP通道，强制做多，无视常规规则
```

---

## 📈 完整决策流程

```
1. 读取Oracle信号
   ├─ 1分钟CVD: +$45K
   ├─ 5分钟CVD: +$120K
   ├─ 融合CVD: +3.07
   ├─ 盘口不平衡: +1.2
   └─ Oracle总分: +4.27

2. 读取本地信号
   ├─ 价格动量: +2.5
   ├─ VWAP偏离: +1.0
   ├─ RSI状态: 0
   ├─ 趋势强度: +1.2
   └─ 本地总分: +3.7

3. 双核融合
   ├─ 同向判断: 3.7 × 4.27 > 0 ✓
   ├─ Oracle boost: 4.27 ÷ 5 = +0.85
   └─ 融合分数: 3.7 + 0.85 = 4.55

4. Layer 1: Session Memory
   ├─ 先验偏差: +0.35 (历史LONG胜率72%)
   ├─ 先验调整: +0.35 × 2.0 = +0.70
   └─ 调整分数: 4.55 + 0.70 = 5.25

5. 防御层评估
   ├─ 时间锁: ✓
   ├─ 混乱度: ✓
   ├─ 利润空间: ✓
   ├─ CVD一致性: ✓
   └─ 基准距离: ✓
   防御乘数: 1.0

6. 最终输出
   ├─ 方向: LONG
   ├─ 分数: +5.25
   ├─ 置信度: 99%
   └─ 仓位: $3.00 (满仓)
```

---

## 🔧 关键参数

### Oracle融合权重

```python
# 位置: auto_trader_ankr.py line 1874-1878
同向: ÷5  (可调范围: ÷3 到 ÷8)
反向: ÷10 (可调范围: ÷5 到 ÷15)
```

### CVD窗口权重

```python
# 位置: binance_oracle.py line 258-260
5分钟窗口: 70% (可调范围: 50%-90%)
1分钟窗口: 30% (可调范围: 10%-50%)
```

---

## 💡 核心优势

1. **跨市场验证**
   - Polymarket: 预测市场（群体认知）
   - Binance: 现货市场（真实资金）
   - 两者一致 = 信号可靠

2. **抢跑能力**
   - Binance资金流领先1-2分钟
   - Oracle提供"抢跑"信号

3. **错误纠正**
   - 反向融合削弱本地错误判断
   - 避免单一市场噪音

4. **极端捕捉**
   - 核弹级信号VIP通道
   - 捕捉十年一遇的V型反转

---

## 📚 相关文档

- `DUAL_CORE_EXPLAINED.md` - 详细原理说明
- `THREE_LAYER_ARCHITECTURE.md` - 三层架构
- `dual_core_flowchart.py` - 可视化脚本

---

*最后更新: 2026-03-01*
