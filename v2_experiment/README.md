# V2 实验性版本 - 完整重构

## 📋 版本说明

这是基于@jtrevorchapman完整指标系统的实验性重构版本。

**当前运行的版本（稳定）**: `../` (父目录)
**实验性版本（本目录）**: `./v2_experiment/`

---

## 🎯 核心改动

### 1. **架构重构**
- ❌ **移除**"本地分"vs"Oracle分"的区分
- ❌ **移除**Oracle融合逻辑（同向增强/反向削弱）
- ✅ **统一投票系统**：所有指标平等输入
- ✅ **投票系统直接生成**最终方向和置信度

### 2. **新增7个指标规则**

| 规则 | 说明 | 权重 |
|------|------|------|
| **Momentum Acceleration** | 动量加速度（30s→60s→120s变化率） | 1.2x |
| **MACD Histogram** | MACD柱状图（趋势转折点） | 1.0x |
| **EMA Cross** | EMA 9/21 交叉 | 0.9x |
| **Volatility Regime** | 波动率制度（高/低波动） | 0.8x |
| **Delta Z-Score** | CVD标准化分数 | 1.2x |
| **Price Trend 5** | 5周期价格趋势 | 0.8x |
| **Trading Intensity** | 交易强度（成交量变化） | 1.0x |

### 3. **占位规则（5个）**

需要Polymarket订单簿数据，暂时不投票：

- **Bid Walls** - 买墙检测
- **Ask Walls** - 卖墙检测
- **Orderbook Imbalance** - 订单簿失衡
- **PM Spread Dev** - YES/NO价差异常
- **PM Sentiment** - Polymarket情绪分析

---

## 📊 投票系统配置

### **总计21个规则**

```
已激活（16个）：
  ├─ 超短动量 x3:          0.8 + 0.9 + 1.0 = 2.7x (12.1%)
  ├─ 标准指标 x5:          1.0 + 1.0 + 1.0 + 1.0 + 0.8 = 4.8x (21.5%)
  ├─ CVD系列 x3:           3.0 + 1.5 + 1.2 = 5.7x (25.6%) ← 主导
  ├─ 高级指标 x5:          1.2 + 1.0 + 0.9 + 0.8 + 1.0 = 4.9x (22.0%)
  └─ 趋势指标 x2:          1.0 + 1.0 = 2.0x (9.0%)

占位（5个，不投票）：
  └─ 订单簿/PM数据 x5:     0x (0%)

总权重：22.3x（已激活规则）
```

### **CVD主导地位**
- 5m CVD: 3.0x (13.5%)
- 1m CVD: 1.5x (6.7%)
- Delta Z-Score: 1.2x (5.4%)
- **CVD总权重: 5.7x (25.6%)** ← 最强指标

---

## 🔄 与原版对比

| 维度 | 原版（V1） | 实验版（V2） |
|------|-----------|-------------|
| **架构** | 本地分 + Oracle分融合 | 统一投票系统 |
| **指标数量** | 9个规则 | 21个规则 |
| **CVD权重** | 4.5x / 11.2x (40.2%) | 5.7x / 22.3x (25.6%) |
| **Session Memory** | ✅ 已实现 | ✅ 已实现 |
| **超短动量** | ✅ 币安实时 | ✅ 币安实时 |
| **高级技术指标** | ❌ 无 | ✅ 7个新增 |
| **市场微观结构** | ❌ 无 | ⚠️ 占位（需要数据） |

---

## 🚀 使用方法

### **切换到实验版本**

```bash
# 停止当前运行的程序
# 然后启动实验版本
cd D:\OpenClaw\workspace\BTC_15min_Lite\v2_experiment
python auto_trader_ankr.py
```

### **回退到稳定版本**

```bash
# 停止实验版本
# 然后运行稳定版本
cd D:\OpenClaw\workspace\BTC_15min_Lite
python auto_trader_ankr.py
```

---

## ⚠️ 注意事项

1. **实验性版本未经充分测试**，建议先在模拟环境运行
2. **占位规则不投票**，需要Polymarket订单簿数据才能激活
3. **CVD权重仍然最强**，但占比从40.2%降至25.6%（更均衡）
4. **新增指标可能需要调参**，请根据实盘数据调整

---

## 📝 TODO

- [ ] 实现买墙/卖墙检测（需要Polymarket订单簿API）
- [ ] 实现订单簿失衡（需要Polymarket订单簿API）
- [ ] 实现PM价差异常检测（需要YES/NO实时价格）
- [ ] 实现PM情绪分析（需要Polymarket历史数据）
- [ ] 调优新增指标的权重和阈值
- [ ] 回测验证21规则系统 vs 原9规则系统

---

## 📞 相关文档

- `../ULTRA_SHORT_MOMENTUM_UPGRADE.md` - 超短动量升级文档
- `../VOTING_SYSTEM_INTEGRATION_COMPLETE.md` - 投票系统集成文档
- `../THREE_LAYER_ARCHITECTURE.md` - 三层架构文档

---

*创建时间: 2026-03-01*
*版本: V2 Experiment*
*Commit: 待提交*
